package com.arematics.minecraft.core.bukkit;

import com.arematics.minecraft.core.server.Server;
import com.comphenix.protocol.PacketType;
import com.comphenix.protocol.events.PacketEvent;
import org.bukkit.GameMode;
import org.bukkit.entity.Player;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

@Component
public class CreativeSlotExploitFixer extends ArematicsPacketAdapter {

    @Autowired
    public CreativeSlotExploitFixer(Server server){
        super(server, PacketType.Play.Client.SET_CREATIVE_SLOT);
    }

    @Override
    protected void onReceive(final PacketEvent event) {
        Player player = event.getPlayer();
        if(player.getGameMode() == GameMode.CREATIVE) return;

        server.schedule().runSync(() -> player.kickPlayer("You are sending wrong packets"));

        String message = TEAM_MESSAGE.replace("%name%", player.getName()).replace("%reason%",
                "Creative Slot Exploit");
        server.getOnlineTeam().stream()
                .filter(result -> player.hasPermission("team.crashmessages"))
                .forEach(result -> result.info(message).handle());
        plugin.getLogger()
                .warning(player.getName() + " tried to exploit: Creative Slot Exploit");
    }
}
